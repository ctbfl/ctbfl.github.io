<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
  {% include head.html %}
</head>
<body class="blog-index-page" itemscope itemtype="http://schema.org/WebPage">
{% include chrome-frame.html %}
{% include navigation.html %}

<div id="main" role="main" itemprop="mainContentOfPage">
  <!-- 左侧：头像 + 基本信息（跟 tags.html 一样） -->
  <div class="article-author-top">
    {% include author-bio.html %}
  </div>

  <!-- 右侧：Blog 顶部介绍 -->
  <header class="blog-hero">
    <p class="eyebrow">Writing &amp; Notes</p>
    <h1 class="page-title">Blog</h1>
    <div class="blog-hero-layout">
      <p class="lede">
        Notes, experiments, and updates from my research journey.
      </p>
      <div class="blog-search-box">
        <label for="blog-search-input" class="eyebrow search-label">Search</label>
        <input
          id="blog-search-input"
          type="search"
          placeholder="Search posts by title, tags, or content..."
        >
        <p class="search-hint">
          Press Enter to search or filter by tags below.
        </p>
      </div>
    </div>
  </header>

  <!-- 右侧：Tag 筛选区 -->
  <section class="blog-tags-filter">
    <h2 class="section-title">Browse by tag</h2>

    {% assign all_tags = site.tags | sort %}
    {% if all_tags == empty %}
      <p>No tags yet. Write your first post with some tags to see them here.</p>
    {% else %}
      <div class="tag-filter-pills">
        <!-- ALL 按钮 -->
        <button class="tag-pill is-active" data-filter-tag="__all">
          ALL
        </button>
        {% for tag in all_tags %}
          {% assign tag_name = tag[0] %}
          <button class="tag-pill" data-filter-tag="{{ tag_name | escape }}">
            {{ tag_name }}
          </button>
        {% endfor %}
      </div>
      <p class="post-count" id="blog-post-count"></p>
    {% endif %}
  </section>

  <!-- 右侧：文章列表 -->
  <section class="blog-posts-list" id="blog-posts-list">
    {% assign posts = site.posts | sort: "date" | reverse %}
    {% for post in posts %}
      {% assign post_tags = post.tags | join:' ' | downcase %}
      <article
        class="blog-post-card"
        data-tags="{{ post_tags | escape }}"
        data-title="{{ post.title | downcase | escape }}"
        data-content="{{ post.content | strip_html | strip_newlines | downcase | escape }}"
      >
        <p class="post-date">
          {{ post.date | date: "%B %-d, %Y" }}
        </p>

        <h2 class="post-title">
          <a href="{{ post.url | relative_url }}">
            {{ post.title }}
          </a>
        </h2>

        {% if post.excerpt %}
          <p class="post-excerpt">
            {{ post.excerpt | strip_html | truncate: 200 }}
          </p>
        {% endif %}

        {% if post.tags %}
          <div class="post-tags">
            {% for tag in post.tags %}
              <a
                class="tag-pill tag-pill-small"
                href="{{ '/tag/' | append: tag | append: '/' | relative_url }}"
              >
                {{ tag }}
              </a>
            {% endfor %}
          </div>
        {% endif %}
      </article>
    {% endfor %}
  </section>
</div>

<div class="footer-wrap">
  <footer>
    {% include footer.html %}
  </footer>
</div>

{% include scripts.html %}

<!-- 简单的前端搜索 + tag 筛选逻辑 -->
<script>
  (function() {
    const searchInput = document.getElementById('blog-search-input');
    const postListEl = document.getElementById('blog-posts-list');
    const cards = Array.from(postListEl.querySelectorAll('.blog-post-card'));
    const tagButtons = Array.from(document.querySelectorAll('.tag-filter-pills .tag-pill'));
    const countEl = document.getElementById('blog-post-count');

    let activeTag = '__all';
    let currentQuery = '';

    function normalize(str) {
      return (str || '').toLowerCase();
    }

    function applyFilters() {
      const q = normalize(currentQuery);
      let visibleCount = 0;

      cards.forEach(card => {
        const title = card.dataset.title || '';
        const content = card.dataset.content || '';
        const tags = card.dataset.tags || '';

        // tag 过滤
        const matchTag = (activeTag === '__all') ||
                         tags.split(/\s+/).includes(activeTag.toLowerCase());

        // 搜索过滤（标题 + 内容 + tag 文本）
        const haystack = [title, content, tags].join(' ');
        const matchSearch = q === '' || haystack.indexOf(q) !== -1;

        if (matchTag && matchSearch) {
          card.style.display = '';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      if (countEl) {
        if (visibleCount === 0) {
          countEl.textContent = 'No posts found.';
        } else if (visibleCount === 1) {
          countEl.textContent = '1 post';
        } else {
          countEl.textContent = visibleCount + ' posts';
        }
      }
    }

    // Tag 按钮点击
    tagButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        tagButtons.forEach(b => b.classList.remove('is-active'));
        this.classList.add('is-active');
        activeTag = this.getAttribute('data-filter-tag');
        applyFilters();
      });
    });

    // 搜索框：按 Enter 生效（你也可以改成 input 事件实时过滤）
    if (searchInput) {
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          currentQuery = this.value || '';
          applyFilters();
        }
      });
    }

    // 初始更新计数
    applyFilters();
  })();
</script>
</body>
</html>
